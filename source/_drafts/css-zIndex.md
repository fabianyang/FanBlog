---
title: CSS z-index
categories:
- CSS
tags:
- z-index
date: 2017-01-02 15:04:51
---

### 前言

    `[MDN](https://developer.mozilla.org/zh-CN/docs/Web/CSS/z-index)` `[w3c](https://www.w3.org/TR/CSS22/visuren.html#z-index)`

    z-index 属性指定了一个元素及其子元素的 z-order。 当元素之间重叠的时候，z-order 决定哪一个元素覆盖在其余元素的上方显示。 通常来说 z-index 较大的元素会覆盖较小的一个。

    注意：要理解 dom 流，层叠上下文概念。

### z-index 的属性值

默认：`auto`;

基本特性：
1. 支持负值
2. 支持 (css3 animation)
3. css2.1 时，需要和定位元素配合使用。

如果不考虑 css3, 只有定位元素 `position: relative|absolute|fixed|sticky;` 的 z-index 才有作用。

在 css3 中有例外。

### 嵌套表现以及 z-index 计算规则

#### z-index 与定位属性

如果定位元素 z-index 没有发生嵌套，后面的元素在上面，哪个 z-index 值大，哪个在上面。

官网解释：如果定位元素 z-index 发生嵌套，前提：z-index 是数值非 `auto` ，祖先优先。

### 理解 css 中的层叠上下文 (stacking level) 和层叠水平 (stacking level)

重要概念：理解元素层叠表现的基础。三维概念。

1. 页面根元素天生具有层叠上下文。
2. z-index 值为数值时，定位元素具有层叠上下文。
3. 层叠上下文中的每个元素都有一个层叠水平，决定同一个层叠上下文中元素在 z 轴上的显示顺序。
4. 层叠水平和 z-index 不是同一个概念。普通元素也有层叠水平，z-index 只在定位元素中起作用。

### 理解元素的层叠顺序 (stacking order)
1. 7 阶层叠水平 (stacking order)。
2. 规范元素重叠时候的呈现规则。
3. 更符合页面加载的功能和视觉呈现。
4. 内容是页面最重要的实体。因此，层叠水平更高。
5. 背景覆盖是层叠水平顺序，文字是覆盖后来居上。

### z-index 与层叠上下文，解释 z-index 的实际行为表现
1. 定位元素，默认 `z-index: auto;` 等于 `z-index: 0;`。
2. z-index 不为 `auto` 的定位元素会创建层叠上下文。
3. z-index 比较层叠顺序止步于父级层叠上下文。

#### 为什么定位元素会覆盖普通元素

从层叠顺序上讲 `z-index: auto;` 可以看成 `z-index: 0;`

但从层叠上下文来讲 `z-index: auto;` 不会创建层叠上下文。 `z-index: 0;` 才会创建。

但不包括 ie7 浏览器。

### z-index 与其他 css 属性层叠上下文
非定位元素层叠上下文与 z-index 的关系

1. 不支持 z-index 的层叠上下文元素的层叠顺序，均是 `z-index:auto;` 级别。
2. 依赖 z-index 的层叠上下文元素的层叠顺序取决于 z-index 的值。

依赖 z-index 值创建层叠上下文的情况：
- `position: relative|absolute|fixed;` fixed 部分浏览器 
- `display: flex|inline-flex;` 容器的子 flex 项

有趣现象：
`opacity: 0` -> `opacity: 1` 的动画，在动画结束时文字才会出现。

本质其实就是规范规定，透明度不为 1 的元素是有层叠上下文的。

`opacity: 1` 普通图片，其他 opacity 值会新建层叠上下文。

层叠顺序 `z-index: auto;` 级别，跟 absolute 文字一样，但遵循后来居上的准则。

于是，淡出的时候，文字是看不见的，知道动画结束 `opacity: 1;`

基本套路：
再遇到类似情景，可以想下是不是哪个地方新建了层叠上下文，改变了层叠顺序，改变了覆盖关系。

### z-index 实践经验分享

#### 1. 最小化影响原则（relative 讲到过）

目的：避免 z-index 嵌套层叠关系混乱

原因：
1. 元素的层叠水平主要是由所在的层叠上下文决定。
2. ie7 `z-index: auto;` 也会创建层叠上下文。

做法：
1. 避免使用任何定位属性。
2. 定位属性从大容器平级分离为私有小容器。

#### 2. z-index 没有任何道理需要超过 2 （对于非浮动元素）

目的：避免 z-index 混乱，一山比一山高样式问题。

比如：设置一个元素的 z-index 值后，发现蒙层的 z-index 比新的元素的 z-index 小了。

原因：多人协作及后期维护

做法：
对于非浮层元素，避免设置 z-index 值 （灵活利用层叠顺序，后来居上，层叠上下文，层叠水平规则进行覆盖，比如：改变 dom 顺序，新建层叠上下文 `transform: scale(1)`）

该原则的遵守可以保证永远不会出现浮层被覆盖的情况，可以进行团队推广。

#### 3. 组件层级计数器
目的：避免浮层组件的 z-index 被覆盖问题

原因：
1. 总会有意想不到的高层级元素

比如：其他团队进入或第三方插件引入。

2. 组件的覆盖规则具有动态性

比如：有多个弹窗，信息弹窗盖住表单弹窗。

做法：通过 JS 获取 `body` 下子元素的最大 `z-index` 值。

#### 4. 可访问性隐藏

即：肉眼不可见，但是辅助设备可以识别。

比如：定位到屏幕外或 `clip: 0` 看不到

做法：
z-index 负值元素在层叠上下文的背景之上，其他元素之下。

PS: 如果不考虑低版本 ie 浏览器，可以直接 `display: none;` 隐藏元素。高版本浏览器依然可以触发完全隐藏元素默认提交事件。